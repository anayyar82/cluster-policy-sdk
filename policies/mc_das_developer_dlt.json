@dlt.view()
def insulin_format_user_time_stamp():
    # Read the bronze table directly
    df = dlt.read("INSULIN_BRONZE")

    # Modify userRecorded based on the condition
    df = df.withColumn(
        "userRecorded",
        to_timestamp(
            when((instr(col("userRecorded").substr(-6, 1), '+') > 0) | (instr(col("userRecorded").substr(-6, 1), '-') > 0),
                 col("userRecorded").substr(0, length(col("userRecorded")) - 6))
            .otherwise(col("userRecorded"))
        )
    )

    # Convert factoryrecorded to timestamp and return the final DataFrame
    return df.withColumn("factoryrecorded", to_timestamp(col("factoryrecorded")))
